{"version":3,"file":"static/js/14.f14912bd.chunk.js","mappings":"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","sources":["pages/Login.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { \r\n  Button, \r\n  Modal, \r\n  Form, \r\n  Spinner, \r\n  Alert,\r\n  // (เราต้อง Import Row/Col มาด้วย)\r\n  Container, \r\n  Row, \r\n  Col, \r\n  Card \r\n} from \"react-bootstrap\";\r\nimport { useNavigate } from \"react-router-dom\"; // (Import useNavigate)\r\nimport axios from \"axios\"; \r\n\r\n// --- 1. API Config ---\r\nconst AUTH_TABLE_ID = \"733326\"; // (ID ตาราง auth_user ของคุณ)\r\nconst API_TOKEN = \"pJmbVWCV1NFQ7333Cmqj822hINsyguMW\"; // (Token ของคุณ)\r\n\r\n// (Endpoint สำหรับ \"ค้นหา\" user)\r\nconst LIST_USERS_URL = `https://api.baserow.io/api/database/rows/table/${AUTH_TABLE_ID}/`;\r\n// (Endpoint สำหรับ \"ตรวจสอบ\" รหัสผ่าน) [cite: 333-334]\r\nconst AUTH_PASSWORD_URL = \"https://api.baserow.io/api/database/fields/password-authentication/\";\r\n\r\n// (ID คอลัมน์ \"Password\" ของคุณ)\r\nconst PASSWORD_FIELD_ID = 6167723; \r\n\r\nexport default function Login() {\r\n  const navigate = useNavigate(); // (ใช้ navigate แทน window.location)\r\n\r\n  // --- 2. State (เปลี่ยนจาก row_id เป็น userId) ---\r\n  const [userId, setUserId] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // --- 3. ฟังก์ชันล็อกอิน (ฉบับอัปเกรด) ---\r\n  const handleLogin = async (e) => {\r\n    e.preventDefault(); \r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      // === Step 1: ค้นหา User ID (user_name) ===\r\n      const listConfig = {\r\n        method: \"get\",\r\n        url: `${LIST_USERS_URL}?user_field_names=true&filter__user_name__equal=${userId}`,\r\n        headers: { Authorization: `Token ${API_TOKEN}` }\r\n      };\r\n\r\n      const userResponse = await axios.request(listConfig);\r\n\r\n      if (userResponse.data.results.length === 0) {\r\n        setError(\"User ID นี้ไม่มีอยู่ในระบบ\");\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      const user = userResponse.data.results[0];\r\n      const rowId = user.id; // (ได้ row_id ของ user แล้ว)\r\n\r\n      // === Step 2: ตรวจสอบรหัสผ่าน (ตามสไลด์) === \r\n      const authData = {\r\n        field_id: PASSWORD_FIELD_ID, \r\n        row_id: rowId,               \r\n        password: password           \r\n      };\r\n      \r\n      const authConfig = {\r\n        method: \"post\",\r\n        url: AUTH_PASSWORD_URL,\r\n        headers: { \r\n          Authorization: `Token ${API_TOKEN}`,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        data: authData\r\n      };\r\n\r\n      const authResponse = await axios.request(authConfig);\r\n\r\n      // === Step 3: ตรวจสอบผลลัพธ์ (ตามสไลด์) ===\r\n      if (authResponse.data.is_correct === true) { // [cite: 409]\r\n        alert(\"ล็อกอินสำเร็จ!\");\r\n        \r\n        // (เก็บข้อมูลลง localStorage)\r\n        localStorage.setItem(\"auth_user_id\", rowId); // [cite: 410]\r\n        localStorage.setItem(\"user\", JSON.stringify(user)); \r\n        \r\n        // (ใช้ window.location.href เพื่อ Reload ทั้งหน้า) [cite: 411]\r\n        window.location.href = \"/home\";\r\n      } else {\r\n        setError(\"Password ไม่ถูกต้อง\");\r\n        setLoading(false);\r\n      }\r\n\r\n    } catch (err) { // [cite: 345-346]\r\n      console.error(\"Login Error:\", err);\r\n      setError(\"เกิดข้อผิดพลาดในการเชื่อมต่อ: \" + err.message);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  // --- 4. ส่วนแสดงผล (Layout) ---\r\n  // (ผมใช้ Layout แบบ Card ที่สวยกว่าในสไลด์ครับ)\r\n  return (\r\n    <Container className=\"d-flex justify-content-center align-items-center\" style={{ minHeight: \"80vh\" }}>\r\n      <Row>\r\n        <Col>\r\n          <Card style={{ width: '25rem' }}>\r\n            <Card.Body className=\"p-4\">\r\n              <Card.Title as=\"h3\" className=\"text-center mb-4\">\r\n                เข้าสู่ระบบ (FLOW)\r\n              </Card.Title>\r\n\r\n              {error && <Alert variant=\"danger\">{error}</Alert>}\r\n\r\n              {/* vvv แก้ไข Form ให้รับ user_name vvv */}\r\n              <Form onSubmit={handleLogin}>\r\n                <Form.Group className=\"mb-3\">\r\n                  <Form.Label>User ID (user_name)</Form.Label>\r\n                  <Form.Control \r\n                    type=\"text\" \r\n                    placeholder=\"๊User ID\"\r\n                    value={userId}\r\n                    onChange={(e) => setUserId(e.target.value)}\r\n                  />\r\n                </Form.Group>\r\n\r\n                <Form.Group className=\"mb-3\">\r\n                  <Form.Label>Password</Form.Label>\r\n                  <Form.Control \r\n                    type=\"password\"\r\n                    placeholder=\"Password\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                  />\r\n                </Form.Group>\r\n\r\n                <div className=\"d-grid gap-2 mt-4\">\r\n                  <Button \r\n                    variant=\"primary\" \r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                  >\r\n                    {loading ? (\r\n                      <Spinner animation=\"border\" size=\"sm\" />\r\n                    ) : (\r\n                      \"เข้าสู่ระบบ\" // [cite: 376]\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              </Form>\r\n\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n}"],"names":["API_TOKEN","LIST_USERS_URL","concat","AUTH_PASSWORD_URL","PASSWORD_FIELD_ID","Login","useNavigate","userId","setUserId","useState","password","setPassword","loading","setLoading","error","setError","_jsx","Container","className","style","minHeight","children","Row","Col","Card","width","_jsxs","Body","Title","as","Alert","variant","Form","onSubmit","async","e","preventDefault","listConfig","method","url","headers","Authorization","userResponse","axios","request","data","results","length","user","rowId","id","authData","field_id","row_id","authConfig","is_correct","alert","localStorage","setItem","JSON","stringify","window","location","href","err","console","message","Group","Label","Control","type","placeholder","value","onChange","target","Button","disabled","Spinner","animation","size"],"sourceRoot":""}